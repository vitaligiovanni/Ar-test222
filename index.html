<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR Photo to Video Transition</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #0c0c0c 0%, #1a1a1a 100%);
            font-family: Arial, sans-serif;
            overflow: hidden;
            height: 100vh;
            color: white;
            position: relative;
        }

        #container {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #cameraVideo {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: 1;
        }

        #backgroundOverlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 30% 30%, rgba(0, 255, 0, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 70% 70%, rgba(0, 255, 255, 0.1) 0%, transparent 50%),
                linear-gradient(45deg, #0c0c0c 0%, #1a1a1a 50%, #2a2a2a 100%);
            z-index: 2;
        }

        #overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10;
            pointer-events: none;
        }

        .demo-marker {
            position: absolute;
            background: rgba(0, 255, 0, 0.2);
            border: 3px solid #00ff00;
            border-radius: 15px;
            pointer-events: all;
            cursor: pointer;
            transition: all 0.4s ease;
            animation: pulse 3s infinite;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
            text-align: center;
            color: #00ff00;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(0, 255, 0, 0.7); }
            70% { box-shadow: 0 0 0 30px rgba(0, 255, 0, 0); }
            100% { box-shadow: 0 0 0 0 rgba(0, 255, 0, 0); }
        }

        .demo-marker:hover {
            background: rgba(0, 255, 0, 0.4);
            transform: scale(1.05);
        }

        #videoOverlay {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.8);
            width: 90%;
            max-width: 600px;
            z-index: 2000;
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.8);
            opacity: 0;
            visibility: hidden;
            transition: all 0.6s ease;
            background: rgba(0, 0, 0, 0.95);
            padding: 20px;
            border: 2px solid #00ff00;
        }

        #videoOverlay.show {
            opacity: 1;
            visibility: visible;
            transform: translate(-50%, -50%) scale(1);
        }

        #overlayVideo {
            width: 100%;
            height: auto;
            border-radius: 15px;
            background: #000;
        }

        #closeBtn {
            position: absolute;
            top: -15px;
            right: -15px;
            width: 40px;
            height: 40px;
            background: #ff4444;
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 20px;
            cursor: pointer;
            z-index: 2100;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        #closeBtn:hover {
            background: #ff6666;
            transform: scale(1.1);
        }

        #instructions {
            position: fixed;
            top: 20px;
            left: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px;
            border-radius: 10px;
            z-index: 1500;
            text-align: center;
            font-size: 14px;
            border: 2px solid #00ff00;
        }

        #loadingScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 3000;
            color: white;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #333;
            border-top: 4px solid #00ff00;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .play-button {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(45deg, #00ff00, #00cc00);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            z-index: 1500;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 255, 0, 0.3);
        }

        .play-button:hover {
            transform: translateX(-50%) scale(1.05);
        }

        .center-trigger {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 200px;
            height: 200px;
            border: 3px dashed #00ff00;
            border-radius: 50%;
            background: rgba(0, 255, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 15;
            animation: breathe 3s infinite;
            pointer-events: all;
        }

        @keyframes breathe {
            0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 0.7; }
            50% { transform: translate(-50%, -50%) scale(1.1); opacity: 1; }
        }

        .center-trigger:hover {
            background: rgba(0, 255, 0, 0.3);
            transform: translate(-50%, -50%) scale(1.2);
        }

        .center-trigger::after {
            content: "‚ñ∂Ô∏è –ù–ê–ñ–ú–ò–¢–ï";
            font-size: 16px;
            color: #00ff00;
            font-weight: bold;
            text-align: center;
        }

        .hidden {
            display: none !important;
        }

        #permissionScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 4000;
            color: white;
            text-align: center;
            padding: 20px;
        }

        .permission-btn {
            background: #00ff00;
            color: black;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s ease;
        }

        .permission-btn:hover {
            background: #00cc00;
            transform: scale(1.05);
        }

        .skip-btn {
            background: #666;
            color: white;
        }

        .skip-btn:hover {
            background: #888;
        }

        @media (max-width: 768px) {
            #instructions {
                font-size: 12px;
                padding: 10px;
            }
            
            #videoOverlay {
                width: 95%;
                padding: 10px;
            }

            .center-trigger {
                width: 150px;
                height: 150px;
            }

            .center-trigger::after {
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <!-- –≠–∫—Ä–∞–Ω —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π -->
    <div id="permissionScreen">
        <h2>üé¨ AR –í–∏–¥–µ–æ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</h2>
        <p>–î–ª—è —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ</p>
        <br>
        <button class="permission-btn" id="requestCameraBtn">
            üì∑ –†–∞–∑—Ä–µ—à–∏—Ç—å –∫–∞–º–µ—Ä—É
        </button>
        <button class="permission-btn skip-btn" id="skipCameraBtn">
            ‚è≠Ô∏è –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å (–¥–µ–º–æ —Ä–µ–∂–∏–º)
        </button>
        <br>
        <small>–í –¥–µ–º–æ —Ä–µ–∂–∏–º–µ –±—É–¥—É—Ç –ø–æ–∫–∞–∑–∞–Ω—ã –ø—Ä–∏–º–µ—Ä—ã –º–∞—Ä–∫–µ—Ä–æ–≤</small>
    </div>

    <!-- –≠–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <div id="loadingScreen" class="hidden">
        <div class="spinner"></div>
        <p>–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞–º–µ—Ä—ã...</p>
    </div>

    <div id="container">
        <video id="cameraVideo" autoplay playsinline muted class="hidden"></video>
        <div id="backgroundOverlay"></div>
        
        <div id="overlay">
            <div class="center-trigger" id="centerTrigger"></div>
        </div>
        
        <div id="instructions">
            üì± –ù–∞–≤–µ–¥–∏—Ç–µ –∫–∞–º–µ—Ä—É –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ-–º–∞—Ä–∫–µ—Ä –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—É—é –æ–±–ª–∞—Å—Ç—å –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –≤–∏–¥–µ–æ
        </div>

        <button class="play-button" id="playVideoBtn">
            ‚ñ∂Ô∏è –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –≤–∏–¥–µ–æ
        </button>

        <div id="videoOverlay">
            <button id="closeBtn">&times;</button>
            <video id="overlayVideo" controls playsinline preload="metadata">
                <source src="./BoudoirPhotoBox.mp4" type="video/mp4">
                –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–∏–¥–µ–æ.
            </video>
        </div>
    </div>

    <script>
        class ARVideoApp {
            constructor() {
                this.cameraVideo = document.getElementById('cameraVideo');
                this.overlayVideo = document.getElementById('overlayVideo');
                this.videoOverlay = document.getElementById('videoOverlay');
                this.closeBtn = document.getElementById('closeBtn');
                this.playVideoBtn = document.getElementById('playVideoBtn');
                this.centerTrigger = document.getElementById('centerTrigger');
                this.loadingScreen = document.getElementById('loadingScreen');
                this.permissionScreen = document.getElementById('permissionScreen');
                this.backgroundOverlay = document.getElementById('backgroundOverlay');
                this.requestCameraBtn = document.getElementById('requestCameraBtn');
                this.skipCameraBtn = document.getElementById('skipCameraBtn');
                
                this.hasCamera = false;
                this.isVideoPlaying = false;
                this.stream = null;
                this.demoMarkers = [];
                
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.createDemoMarkers();
            }

            setupEventListeners() {
                // –ö–Ω–æ–ø–∫–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π
                this.requestCameraBtn.addEventListener('click', () => {
                    this.requestCamera();
                });

                this.skipCameraBtn.addEventListener('click', () => {
                    this.skipCamera();
                });

                // –û—Å–Ω–æ–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
                this.playVideoBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    this.showVideo();
                });

                this.centerTrigger.addEventListener('click', (e) => {
                    e.preventDefault();
                    this.showVideo();
                });

                this.closeBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    this.hideVideo();
                });

                this.videoOverlay.addEventListener('click', (e) => {
                    if (e.target === this.videoOverlay) {
                        this.hideVideo();
                    }
                });

                // –°–æ–±—ã—Ç–∏—è –≤–∏–¥–µ–æ
                this.overlayVideo.addEventListener('loadeddata', () => {
                    console.log('–í–∏–¥–µ–æ –≥–æ—Ç–æ–≤–æ –∫ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—é');
                });

                this.overlayVideo.addEventListener('error', (e) => {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–µ–æ:', e);
                    alert('‚ö†Ô∏è –í–∏–¥–µ–æ—Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω!\n\n–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Ñ–∞–π–ª "BoudoirPhotoBox.mp4" –∑–∞–≥—Ä—É–∂–µ–Ω –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π');
                });

                this.overlayVideo.addEventListener('ended', () => {
                    setTimeout(() => this.hideVideo(), 1000);
                });

                // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –∑—É–º–∞
                this.preventZoom();
            }

            async requestCamera() {
                this.showLoading();

                try {
                    const constraints = {
                        video: {
                            facingMode: { ideal: 'environment' },
                            width: { ideal: 1280 },
                            height: { ideal: 720 }
                        }
                    };

                    this.stream = await navigator.mediaDevices.getUserMedia(constraints);
                    this.cameraVideo.srcObject = this.stream;
                    this.hasCamera = true;
                    
                    this.cameraVideo.onloadedmetadata = () => {
                        this.cameraVideo.play();
                        this.cameraVideo.classList.remove('hidden');
                        this.backgroundOverlay.style.display = 'none';
                        this.hideLoading();
                        this.startDetection();
                    };

                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ:', error);
                    this.hideLoading();
                    alert('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ\n\n–ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –¥–µ–º–æ —Ä–µ–∂–∏–º...');
                    this.skipCamera();
                }
            }

            skipCamera() {
                this.permissionScreen.classList.add('hidden');
                console.log('–ó–∞–ø—É—Å–∫ –≤ –¥–µ–º–æ —Ä–µ–∂–∏–º–µ –±–µ–∑ –∫–∞–º–µ—Ä—ã');
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–µ–º–æ –º–∞—Ä–∫–µ—Ä—ã
                this.showDemoMarkers();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
                document.getElementById('instructions').innerHTML = 
                    'üé¨ –î–ï–ú–û –†–ï–ñ–ò–ú: –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∑–µ–ª–µ–Ω—ã–µ –æ–±–ª–∞—Å—Ç–∏ –∏–ª–∏ –∫–Ω–æ–ø–∫—É –≤–Ω–∏–∑—É –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –≤–∏–¥–µ–æ';
            }

            showLoading() {
                this.permissionScreen.classList.add('hidden');
                this.loadingScreen.classList.remove('hidden');
            }

            hideLoading() {
                this.loadingScreen.classList.add('hidden');
            }

            createDemoMarkers() {
                // –°–æ–∑–¥–∞–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–µ–º–æ –º–∞—Ä–∫–µ—Ä–æ–≤ –¥–ª—è –ø–æ–∫–∞–∑–∞
                const positions = [
                    { left: '20%', top: '25%', width: '150px', height: '100px', text: '–ú–ê–†–ö–ï–† 1' },
                    { left: '60%', top: '20%', width: '120px', height: '120px', text: '–ú–ê–†–ö–ï–† 2' },
                    { left: '30%', top: '60%', width: '140px', height: '90px', text: '–ú–ê–†–ö–ï–† 3' }
                ];

                positions.forEach((pos, index) => {
                    const marker = document.createElement('div');
                    marker.className = 'demo-marker';
                    marker.style.left = pos.left;
                    marker.style.top = pos.top;
                    marker.style.width = pos.width;
                    marker.style.height = pos.height;
                    marker.textContent = pos.text;
                    marker.style.display = 'none';
                    
                    marker.addEventListener('click', (e) => {
                        e.preventDefault();
                        console.log(`–ö–ª–∏–∫ –ø–æ –¥–µ–º–æ –º–∞—Ä–∫–µ—Ä—É ${index + 1}`);
                        this.showVideo();
                    });

                    this.demoMarkers.push(marker);
                    document.getElementById('overlay').appendChild(marker);
                });
            }

            showDemoMarkers() {
                this.demoMarkers.forEach((marker, index) => {
                    setTimeout(() => {
                        marker.style.display = 'flex';
                    }, index * 500);
                });
            }

            startDetection() {
                if (this.hasCamera) {
                    // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Ä–µ–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –º–∞—Ä–∫–µ—Ä–æ–≤
                    console.log('–ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –º–∞—Ä–∫–µ—Ä–æ–≤');
                }
            }

            async showVideo() {
                if (this.isVideoPlaying) return;
                
                console.log('üé¨ –ó–∞–ø—É—Å–∫ –≤–∏–¥–µ–æ...');
                this.isVideoPlaying = true;
                
                try {
                    if (!this.overlayVideo.paused) {
                        this.overlayVideo.pause();
                    }
                    
                    this.overlayVideo.currentTime = 0;
                    this.videoOverlay.classList.add('show');
                    
                    await new Promise(resolve => setTimeout(resolve, 100));
                    
                    // –ü–æ–ø—ã—Ç–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è —Å–æ –∑–≤—É–∫–æ–º
                    this.overlayVideo.muted = false;
                    await this.overlayVideo.play();
                    console.log('‚úÖ –í–∏–¥–µ–æ –∑–∞–ø—É—â–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ');
                    
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è:', error);
                    
                    try {
                        // Fallback: –±–µ–∑ –∑–≤—É–∫–∞
                        this.overlayVideo.muted = true;
                        await this.overlayVideo.play();
                        console.log('üîá –í–∏–¥–µ–æ –∑–∞–ø—É—â–µ–Ω–æ –±–µ–∑ –∑–≤—É–∫–∞');
                    } catch (mutedError) {
                        console.error('–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞:', mutedError);
                        this.isVideoPlaying = false;
                        this.hideVideo();
                        alert('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –≤–∏–¥–µ–æ\n\n–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Ñ–∞–π–ª "BoudoirPhotoBox.mp4" –¥–æ—Å—Ç—É–ø–µ–Ω');
                    }
                }
            }

            hideVideo() {
                console.log('‚èπÔ∏è –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤–∏–¥–µ–æ');
                this.isVideoPlaying = false;
                
                try {
                    if (!this.overlayVideo.paused) {
                        this.overlayVideo.pause();
                    }
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏:', error);
                }
                
                this.videoOverlay.classList.remove('show');
            }

            preventZoom() {
                document.addEventListener('touchstart', (e) => {
                    if (e.touches.length > 1) {
                        e.preventDefault();
                    }
                }, { passive: false });

                let lastTouchEnd = 0;
                document.addEventListener('touchend', (e) => {
                    const now = Date.now();
                    if (now - lastTouchEnd <= 300) {
                        e.preventDefault();
                    }
                    lastTouchEnd = now;
                }, false);
            }
        }

        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è AR Video App');
            new ARVideoApp();
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–º–µ–Ω—ã –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏
        window.addEventListener('orientationchange', () => {
            setTimeout(() => {
                location.reload();
            }, 1000);
        });

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏
        window.addEventListener('load', () => {
            console.log('‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
        });
    </script>
</body>
</html>
